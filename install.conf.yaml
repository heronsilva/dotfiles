- defaults:
    link:
      create: true
      relink: true

- clean: ["~"]

- link:
    # shell
    ~/.bashrc:
      path: home/.bashrc
      force: true

    ~/.zsh:
      force: true
      path: home/.zsh
    ~/.zshrc:
      force: true
      path: home/.zsh/.zshrc
    ~/.p10k.zsh: home/.p10k.zsh

    # terminal emulators
    ~/.config/alacritty:
      create: true
      path: home/.config/alacritty
    ~/.config/wezterm:
      create: true
      path: home/.config/wezterm

    # vim
    ~/.vimrc: home/.vimrc
    ~/.ideavimrc: home/.ideavimrc
    ~/.config/nvim:
      create: true
      path: home/.config/nvim

    # scripts
    ~/.local/bin/yt-wpp: home/.local/bin/yt-wpp.sh

    # in case of deleting ~/.config/nvim, use this to relink:
    # mv ~/.config/nvim .config/
    # ln -s ~/Workbench/dotfiles/.config/nvim ~/.config/nvim
    # ls -l ~/.config | grep nvim # check if it was succesfully linked

    ~/.config/mise:
      create: true
      path: home/.config/mise
    ~/.gitconfig: home/.gitconfig
    ~/.git/hooks/prevent-force-push: home/.config/git/hooks/prevent-force-push
    ~/.inputrc: .inputrc
    ~/.tmux.conf: home/.tmux.conf
    ~/.Brewfile: home/Brewfile
    ~/.finicky.ts: home/finicky.ts

- create:
    - ~/Workbench
    - ~/.vim/undodir

- shell:
    - [git submodule update --init --recursive, Installing submodules]

    - description: "Install mise"
      command: |
        if ! command -v mise >/dev/null 2>&1; then
          echo "Installing mise..."

          curl https://mise.run | sh

          # Add mise to PATH for current session
          export PATH="$HOME/.local/bin:$PATH"

          # Verify installation
          if command -v mise >/dev/null 2>&1; then
            echo "mise installed successfully"
            echo "Installing mise tools..."

            mise install
          else
            echo "mise installation may have failed, but anyways..."
          fi
        else
          echo "mise is already installed, skipping..."
        fi

    - description: "Compile copyfile.swift"
      command: |
        if [ "$(uname)" = "Darwin" ]; then
          swiftc ./bin/copyfile.swift -o ~/.local/bin/copyfile
        fi

    - description: install vim plug
      command: |
        curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

    - description: "Install fonts"
      command: "sh ./scripts/install-fonts.sh"

    - description: "Configure PM2 logrotate"
      command: "sh ./scripts/pm2-logrotate.sh"
